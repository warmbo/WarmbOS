<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notes</title>
  <link rel="stylesheet" href="../../assets/css/apps/notes.css">
</head>
<body>
  <!-- Sidebar to list and add notes -->
  <div id="sidebar" class="notes-sidebar">
    <h2>My Notes</h2>
    <button class="add-note-btn" onclick="addNote()">+ Add Note</button>
    <div id="note-list" class="notes-list"></div>
  </div>

  <!-- Main panel for editing selected note -->
  <div id="main" class="notes-main">
    <input type="text" id="note-title" class="notes-input" placeholder="Note title..." oninput="updateNote('title', this.value)" />
    <textarea id="note-content" class="notes-textarea" placeholder="Write your note here..." oninput="updateNote('content', this.value)"></textarea>
  </div>

  <script>
    // Load notes from localStorage, or create an initial note if empty
    let notes = JSON.parse(localStorage.getItem('notes')) || [
      { id: Date.now(), title: "First Note", content: "Start typing..." }
    ];

    // Set the first note as the active one initially
    let activeNoteId = notes[0]?.id || null;

    // Save current notes array to localStorage
    function saveNotes() {
      localStorage.setItem('notes', JSON.stringify(notes));
    }

    // Render all notes in the sidebar
    function renderNotes() {
      const list = document.getElementById('note-list');
      list.innerHTML = '';

      notes.forEach(note => {
        const item = document.createElement('div');
        item.className = 'note-item' + (note.id === activeNoteId ? ' active' : '');
        item.onclick = () => setActiveNote(note.id);

        // Render title and delete button for each note
        item.innerHTML = `<span>${note.title}</span><button onclick="deleteNote(${note.id}); event.stopPropagation();">Ã—</button>`;

        list.appendChild(item);
      });
    }

    // Make a note active and populate the main editor with its content
    function setActiveNote(id) {
      activeNoteId = id;
      const note = notes.find(n => n.id === id);
      if (note) {
        document.getElementById('note-title').value = note.title;
        document.getElementById('note-content').value = note.content;
      }
      renderNotes();
    }

    // Update the current note's title or content
    function updateNote(field, value) {
      const note = notes.find(n => n.id === activeNoteId);
      if (note) {
        note[field] = value;
        saveNotes();
        renderNotes(); // Update sidebar title if changed
      }
    }

    // Add a new blank note and make it active
    function addNote() {
      const newNote = { id: Date.now(), title: "Untitled Note", content: "" };
      notes.push(newNote);
      activeNoteId = newNote.id;
      saveNotes();
      setActiveNote(activeNoteId);
    }

    // Delete the note by ID and update state
    function deleteNote(id) {
      notes = notes.filter(note => note.id !== id);
      if (notes.length > 0) {
        activeNoteId = notes[0].id;
      } else {
        activeNoteId = null;
        document.getElementById('note-title').value = '';
        document.getElementById('note-content').value = '';
      }
      saveNotes();
      renderNotes();
      if (activeNoteId) setActiveNote(activeNoteId);
    }

    // Initialize the UI on load
    renderNotes();
    if (activeNoteId) setActiveNote(activeNoteId);
  </script>
</body>
</html>